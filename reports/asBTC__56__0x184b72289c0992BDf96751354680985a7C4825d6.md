# asBTC Token Contract - BNB Chain

## 1. Identity & Sources

- **Name**: asBTC
- **Address/Chain**: `0x184b72289c0992BDf96751354680985a7C4825d6` / Chain ID: 56 (BNB Smart Chain)
- **Source files**: `contracts/oft/asBTC.sol`
- **Compiler/Settings**: Solidity v0.8.25, Optimizer: Yes (1000 runs)
- **特性**: LayerZero OFT (Omnichain Fungible Token)

## 2. Authority Map

### 角色权限
- **Owner**: 通过 Ownable 控制，设置为 Timelock 地址
  - 权限: 合约所有权管理

- **DEFAULT_ADMIN_ROLE**: Timelock 地址
  - 权限: 管理所有角色

- **ADMIN_ROLE**:
  - 权限: 设置转账限制、暂停/恢复合约
  - 函数: setTransferLimitConfigs, pause, unpause

- **MINTER_AND_BURN_ROLE**:
  - 权限: 铸造和销毁代币
  - 函数: mint, burn
  - 限制: amount > 0

## 3. Findings

### HIGH-01: LayerZero 集成安全风险
- **严重程度**: High
- **影响**: 高 / 可能性: 低
- **代码位置**: `contracts/oft/asBTC.sol#L75-85`
- **技术细节**:
  - 跨链转账通过 LayerZero 实现
  - _debit 函数包含转账限制检查
  - 依赖外部 LayerZero 端点安全性
- **风险**:
  - LayerZero 端点被攻击可能影响跨链转账
  - 转账限制可能被绕过
- **修复建议**:
  - 实施额外的跨链验证机制
  - 添加紧急暂停跨链功能
  - 定期审计 LayerZero 集成
- **状态**: Open

### MEDIUM-01: 转账限制机制不透明
- **严重程度**: Medium
- **影响**: 中 / 可能性: 中
- **代码位置**: `contracts/oft/asBTC.sol#L39-41, L83`
- **技术细节**:
  - TransferLimiter 合约未在此文件中定义
  - _checkAndUpdateTransferLimit 的具体逻辑不明
  - 可能存在限制绕过风险
- **修复建议**:
  - 公开转账限制参数
  - 添加限制查询接口
  - 记录限制变更事件
- **状态**: Open

### MEDIUM-02: 铸造/销毁权限集中
- **严重程度**: Medium
- **影响**: 高 / 可能性: 低
- **代码位置**: `contracts/oft/asBTC.sol#L51-59`
- **技术细节**:
  - 单一角色控制所有铸造和销毁
  - 没有铸造上限或速率限制
  - 可能导致供应量操纵
- **修复建议**:
  - 实施多签控制
  - 添加每日铸造限制
  - 分离铸造和销毁角色
- **状态**: Open

### LOW-01: Dust 处理逻辑不明
- **严重程度**: Low
- **影响**: 低 / 可能性: 中
- **代码位置**: `contracts/oft/asBTC.sol#L82`
```solidity
uint256 _amount = _removeDust(_amountLD);
```
- **技术细节**:
  - _removeDust 函数未定义
  - 可能导致精度损失
  - 用户可能损失小额资金
- **修复建议**: 明确 dust 处理逻辑和阈值
- **状态**: Open

## 4. LayerZero 集成分析

### 跨链功能
- 继承 OFT 合约实现跨链代币
- 支持多链部署和转账
- 每个目标链有独立的转账限制

### 安全考虑
1. **端点信任**: 完全依赖 LayerZero 端点
2. **消息验证**: 需要确保消息真实性
3. **重放保护**: LayerZero 协议层面处理

## 5. 代码质量

### 优点
- 使用成熟的 LayerZero OFT 标准
- 实施 ERC20Permit 提高用户体验
- 包含暂停机制应对紧急情况

### 改进建议
- 增加详细的事件日志
- 提供更多查询接口
- 完善错误消息
- 添加铸造/销毁的详细记录

## 6. 链上验证

```bash
# 检查总供应量
cast call 0x184b72289c0992BDf96751354680985a7C4825d6 \
  "totalSupply()(uint256)" \
  --rpc-url https://bsc.drpc.org

# 检查 LayerZero 端点
cast call 0x184b72289c0992BDf96751354680985a7C4825d6 \
  "endpoint()(address)" \
  --rpc-url https://bsc.drpc.org

# 检查暂停状态
cast call 0x184b72289c0992BDf96751354680985a7C4825d6 \
  "paused()(bool)" \
  --rpc-url https://bsc.drpc.org
```